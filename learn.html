<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn - SkillForge</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: sans-serif; }
    .roadmap-item { cursor: pointer; padding: 4px 8px; border-radius: 4px; }
    .completed { background-color: #4a5568; color: #a0aec0; }
    .current { background-color: #6366f1; color: white; font-weight: bold; }
    .pending { color: #cbd5e0; }
    .subtopic { margin-left: 20px; }
    .loader { border: 4px solid #4a5568; border-top: 4px solid #6366f1; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="p-4 border-b border-gray-800">
    <h1 class="text-xl font-bold text-indigo-400">SkillForge - Learning Path</h1>
  </header>

  <!-- MAIN -->
  <main class="flex-1 flex flex-row overflow-hidden">

    <!-- LEFT PANEL: Roadmap -->
    <aside class="w-1/3 bg-gray-900 border-r border-gray-800 p-4 overflow-y-auto">
      <h2 class="text-lg font-semibold mb-4">Roadmap</h2>
      <div id="roadmap-container">
        <!-- Roadmap items will be dynamically added here -->
      </div>
    </aside>

    <!-- RIGHT PANEL: AI Interaction -->
    <section class="flex-1 p-6 flex flex-col">
      <div id="ai-content" class="flex-1 overflow-y-auto">
        <div class="text-center mt-20">
          <div class="loader"></div>
          <p class="mt-4 text-gray-400">Assessing your level...</p>
        </div>
      </div>
      <div class="mt-4 flex">
        <input id="user-answer" type="text" placeholder="Type your answer..." class="flex-1 p-3 rounded-l-lg bg-gray-800 text-white focus:outline-none">
        <button id="submit-answer" class="bg-indigo-600 p-3 rounded-r-lg hover:bg-indigo-500">Submit</button>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="p-4 text-center text-gray-500 text-sm border-t border-gray-800">
    Built with ❤️ by Krishna2646 | SkillForge (MVP)
  </footer>

  <!-- SCRIPT -->
<script>
  let roadmap = [];
  let currentTopicIndex = 0;
  let currentSubtopicIndex = 0;

  const roadmapContainer = document.getElementById('roadmap-container');
  const aiContent = document.getElementById('ai-content');
  const userAnswer = document.getElementById('user-answer');
  const submitAnswer = document.getElementById('submit-answer');

  // Fetch roadmap JSON
  async function loadRoadmap() {
    try {
      const response = await fetch('.roadmaps/machine%20learning.json');
      roadmap = await response.json();
      renderRoadmap();
      loadAIContent();
    } catch (err) {
      console.error("Failed to load roadmap:", err);
      aiContent.innerHTML = `<p class="text-red-500">Failed to load roadmap. Please try again later.</p>`;
    }
  }

  function renderRoadmap() {
    roadmapContainer.innerHTML = '';
    roadmap.forEach((topic, tIndex) => {
      const topicEl = document.createElement('div');
      topicEl.textContent = topic.topic;
      topicEl.classList.add('roadmap-item');
      if (tIndex < currentTopicIndex) topicEl.classList.add('completed');
      else if (tIndex === currentTopicIndex) topicEl.classList.add('current');
      else topicEl.classList.add('pending');
      roadmapContainer.appendChild(topicEl);

      topic.subtopics.forEach((sub, sIndex) => {
        const subEl = document.createElement('div');
        subEl.textContent = sub;
        subEl.classList.add('roadmap-item', 'subtopic');
        if (tIndex < currentTopicIndex || (tIndex === currentTopicIndex && sIndex < currentSubtopicIndex)) subEl.classList.add('completed');
        else if (tIndex === currentTopicIndex && sIndex === currentSubtopicIndex) subEl.classList.add('current');
        else subEl.classList.add('pending');
        roadmapContainer.appendChild(subEl);
      });
    });
  }

  function loadAIContent() {
    if (!roadmap.length) return;

    aiContent.innerHTML = `
      <p class="text-lg">Answer the following question to assess your current level in <strong>${roadmap[currentTopicIndex].topic} - ${roadmap[currentTopicIndex].subtopics[currentSubtopicIndex]}</strong>:</p>
      <p class="mt-4 text-gray-400">[AI-generated question here]</p>
    `;
  }

  submitAnswer.addEventListener('click', () => {
    const answer = userAnswer.value.trim();
    if (!answer) return;

    userAnswer.value = '';

    if (currentSubtopicIndex < roadmap[currentTopicIndex].subtopics.length - 1) {
      currentSubtopicIndex++;
    } else if (currentTopicIndex < roadmap.length - 1) {
      currentTopicIndex++;
      currentSubtopicIndex = 0;
    }

    renderRoadmap();
    loadAIContent();
  });

  // Load roadmap on page start
  loadRoadmap();
</script>

</body>
</html>
