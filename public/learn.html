<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn - SkillForge</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: sans-serif; }
  .roadmap-item { cursor: pointer; padding: 4px 8px; border-radius: 4px; }
  .completed { background-color: #4a5568; color: #a0aec0; }
  .current { background-color: #6366f1; color: white; font-weight: bold; }
  .pending { color: #cbd5e0; }
  .subtopic { margin-left: 20px; }
  .loader { border: 4px solid #4a5568; border-top: 4px solid #6366f1; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: auto; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .chat-message { margin-bottom: 12px; padding: 8px 12px; border-radius: 12px; max-width: 70%; }
  .chat-user { background-color: #1f2937; color: white; align-self: flex-end; }
  .chat-ai { background-color: #4f46e5; color: white; align-self: flex-start; }
  #chat-container { display: flex; flex-direction: column; gap: 6px; }
  .popup { position: fixed; top: 20px; right: 20px; background-color: #111827; color: white; padding: 12px 16px; border-radius: 8px; z-index: 50; box-shadow: 0 4px 8px rgba(0,0,0,0.5); display: none; }
</style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col">

<!-- HEADER -->
<header class="p-4 border-b border-gray-800">
  <h1 class="text-xl font-bold text-indigo-400">SkillForge - Learning Path</h1>
</header>

<!-- MAIN -->
<main class="flex-1 flex flex-row overflow-hidden">

  <!-- LEFT PANEL: Roadmap -->
  <aside class="w-1/3 bg-gray-900 border-r border-gray-800 p-4 overflow-y-auto">
    <h2 class="text-lg font-semibold mb-4">Roadmap</h2>
    <div id="roadmap-container"></div>
  </aside>

  <!-- RIGHT PANEL: Chat / AI -->
  <section class="flex-1 p-6 flex flex-col">
    <div id="chat-container" class="flex-1 overflow-y-auto mb-4 flex flex-col"></div>
    <div class="flex">
      <input id="user-input" type="text" placeholder="Type your answer..." class="flex-1 p-3 rounded-l-lg bg-gray-800 text-white focus:outline-none">
      <button id="submit-btn" class="bg-indigo-600 p-3 rounded-r-lg hover:bg-indigo-500">Submit</button>
    </div>
  </section>

</main>

<!-- FOOTER -->
<footer class="p-4 text-center text-gray-500 text-sm border-t border-gray-800">
  Built with ‚ù§Ô∏è by Krishna2646 | SkillForge (MVP)
</footer>

<!-- POPUP -->
<div id="popup" class="popup"></div>

<!-- SCRIPT -->
<script>
let roadmap = [];
let currentTopicIndex = 0;
let currentSubIndex = 0;
let questionCount = 0;
const maxQuestionsPerMinute = 6;

const roadmapContainer = document.getElementById('roadmap-container');
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const submitBtn = document.getElementById('submit-btn');
const popup = document.getElementById('popup');

// Helper: show popup
function showPopup(message, duration=3000){
  popup.innerText = message;
  popup.style.display = 'block';
  setTimeout(()=>popup.style.display='none', duration);
}

// Load roadmap
fetch('/roadmaps/machine-learning.json')
.then(res=>res.json())
.then(data=>{
  roadmap = data.topics; // assume JSON has { "topics": [...] }
  renderRoadmap();
  askNextQuestion();
})
.catch(err=>{
  roadmapContainer.innerHTML = '‚ùå Failed to load roadmap. Please try again later.';
  console.error(err);
});

// Render roadmap left panel
function renderRoadmap(){
  roadmapContainer.innerHTML = '';
  roadmap.forEach((topic,tIndex)=>{
    let tDiv = document.createElement('div');
    tDiv.innerText = topic.name;
    if(tIndex < currentTopicIndex) tDiv.className='roadmap-item completed';
    else if(tIndex === currentTopicIndex) tDiv.className='roadmap-item current';
    else tDiv.className='roadmap-item pending';
    roadmapContainer.appendChild(tDiv);
    
    if(topic.subtopics){
      topic.subtopics.forEach((sub,sIndex)=>{
        let sDiv = document.createElement('div');
        sDiv.innerText = sub;
        sDiv.className='roadmap-item subtopic '+((tIndex<currentTopicIndex)?'completed': (tIndex===currentTopicIndex && sIndex===currentSubIndex)?'current':'pending');
        roadmapContainer.appendChild(sDiv);
      });
    }
  });
  roadmapContainer.scrollTop = currentTopicIndex*40;
}

// Add message to chat
function addChatMessage(message, sender='ai'){
  const div = document.createElement('div');
  div.className='chat-message '+(sender==='ai'?'chat-ai':'chat-user');
  div.innerText = message;
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Ask next question
function askNextQuestion(){
  if(currentTopicIndex >= roadmap.length){
    addChatMessage('üéâ All topics completed!');
    return;
  }
  let topic = roadmap[currentTopicIndex];
  let sub = topic.subtopics ? topic.subtopics[currentSubIndex] : null;
  let question = `Do you know "${sub || topic.name}" well? (a/b/c/d)`; // simple MCQ placeholder
  addChatMessage(question);
}

// Handle user submit
function handleSubmit(){
  if(questionCount >= maxQuestionsPerMinute){
    showPopup(`‚ö†Ô∏è Maximum ${maxQuestionsPerMinute} questions per minute allowed`);
    return;
  }
  const answer = userInput.value.trim();
  if(!answer) return;
  addChatMessage(answer,'user');
  userInput.value='';

  // Simple assessment logic placeholder
  questionCount++;
  // If correct -> move to next subtopic
  currentSubIndex++;
  if(currentSubIndex >= (roadmap[currentTopicIndex].subtopics?.length||1)){
    currentTopicIndex++;
    currentSubIndex=0;
  }
  renderRoadmap();
  setTimeout(()=>askNextQuestion(),800); // loader delay
}

submitBtn.addEventListener('click', handleSubmit);
userInput.addEventListener('keydown', e=>{
  if(e.key==='Enter') handleSubmit();
});
</script>

</body>
</html>


